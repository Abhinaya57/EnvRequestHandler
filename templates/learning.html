{% extends "base.html" %}

{% block title %}Learning Paths{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="mb-1">
                        <i data-feather="map" class="me-2"></i>
                        Learning Paths
                    </h1>
                    <p class="text-muted mb-0">Gamified learning journey for XR/3D/Game development</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
                        <i data-feather="arrow-left" class="me-1"></i>
                        Back to News
                    </a>
                    <a href="{{ url_for('news_mood') }}" class="btn btn-outline-info">
                        <i data-feather="bar-chart-3" class="me-1"></i>
                        News Mood
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if learning_data %}
    <!-- User Progress Overview -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="card-title">
                                <i data-feather="user" class="me-2"></i>
                                Your Progress
                            </h5>
                            <div class="d-flex align-items-center mb-2">
                                <span class="badge bg-primary fs-6 me-2">Level {{ learning_data.user_level }}</span>
                                <span class="text-muted">{{ learning_data.total_xp }} XP Total</span>
                            </div>
                            <div class="row text-center mt-3">
                                <div class="col-4">
                                    <h4 class="mb-0 text-primary">{{ learning_data.articles_read }}</h4>
                                    <small class="text-muted">Articles Read</small>
                                </div>
                                <div class="col-4">
                                    <h4 class="mb-0 text-success">{{ learning_data.daily_streak }}</h4>
                                    <small class="text-muted">Day Streak</small>
                                </div>
                                <div class="col-4">
                                    <h4 class="mb-0 text-info">{{ learning_data.achievements|length }}</h4>
                                    <small class="text-muted">Achievements</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Achievement Progress</h6>
                            <div class="progress mb-2" style="height: 10px;">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: {{ learning_data.achievement_progress|round(1) }}%"></div>
                            </div>
                            <small class="text-muted">{{ learning_data.achievements|length }}/{{ learning_data.total_achievements }} achievements unlocked</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-success bg-opacity-10 border-success">
                <div class="card-body text-center">
                    <i data-feather="award" class="text-success mb-2" style="width: 3rem; height: 3rem;"></i>
                    <h6 class="mb-1">Current Level</h6>
                    <h2 class="mb-0 text-success">{{ learning_data.user_level }}</h2>
                    <small class="text-muted">{{ learning_data.total_xp }} XP</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Path Progression Info -->
    <div class="row mb-4">
        <div class="col">
            <div class="card bg-info bg-opacity-10 border-info">
                <div class="card-body">
                    <h6 class="text-info mb-3">
                        <i data-feather="info" class="me-2"></i>
                        How Learning Paths Work
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-dark">Level Progression:</h6>
                            <ul class="text-muted">
                                <li><strong>Level 1:</strong> Fundamentals & basics (0 XP required)</li>
                                <li><strong>Level 2:</strong> Intermediate topics (100 XP required)</li>
                                <li><strong>Level 3:</strong> Applications & projects (250 XP required)</li>
                                <li><strong>Level 4:</strong> Advanced techniques (500 XP required)</li>
                                <li><strong>Level 5:</strong> Expert & leadership (1000 XP required)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-dark">How to Progress:</h6>
                            <ul class="text-muted">
                                <li><strong>Read articles:</strong> +5 XP per article</li>
                                <li><strong>Generate AI summaries:</strong> +3 XP per summary</li>
                                <li><strong>Complete learning resources:</strong> Study topics from each level</li>
                                <li><strong>Build projects:</strong> Apply what you learn</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Paths -->
    {% if learning_data.learning_paths %}
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i data-feather="target" class="me-2"></i>
                        Learning Paths - Each Path Has 5 Levels
                    </h5>
                    <div class="row">
                        {% for path_id, path_data in learning_data.learning_paths.items() %}
                        <div class="col-lg-6 mb-4">
                            <div class="card border-{{ path_data.info.color }} h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div class="d-flex align-items-center">
                                            <i data-feather="{{ path_data.info.icon }}" class="text-{{ path_data.info.color }} me-2"></i>
                                            <div>
                                                <h6 class="mb-0">{{ path_data.info.name }}</h6>
                                                <small class="text-muted">{{ path_data.info.description }}</small>
                                            </div>
                                        </div>
                                        <span class="badge bg-{{ path_data.info.color }}">
                                            Level {{ path_data.current_level }}
                                        </span>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <small class="text-muted">{{ path_data.current_level_title }}</small>
                                            {% if not path_data.completed %}
                                            <small class="text-muted">{{ path_data.current_xp }}/{{ path_data.next_level_xp }} XP</small>
                                            {% else %}
                                            <small class="text-success">Completed!</small>
                                            {% endif %}
                                        </div>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-{{ path_data.info.color }}" role="progressbar" style="width: {{ path_data.progress_percent }}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <small class="text-muted fw-bold">Current Topics:</small>
                                        <div class="mt-1">
                                            {% for topic in path_data.info.levels[path_data.current_level - 1].topics[:3] %}
                                            <span class="badge bg-light text-dark me-1 mb-1">{{ topic }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-{{ path_data.info.color }} btn-sm" onclick="showLearningResources('{{ path_id }}', {{ path_data.current_level }})">
                                            <i data-feather="book-open" class="me-1"></i>
                                            Learn Current Topics
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="showLearningPath('{{ path_id }}')">
                                            <i data-feather="map" class="me-1"></i>
                                            View Full Path
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Recent Achievements -->
    {% if learning_data.achievements %}
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i data-feather="star" class="me-2"></i>
                        Recent Achievements ({{ learning_data.achievements|length }})
                    </h5>
                    <div class="row">
                        {% for achievement in learning_data.achievements[:6] %}
                        <div class="col-md-4 col-sm-6 mb-3">
                            <div class="card bg-warning bg-opacity-10 border-warning h-100">
                                <div class="card-body text-center">
                                    <i data-feather="{{ achievement.icon }}" class="text-warning mb-2" style="width: 2rem; height: 2rem;"></i>
                                    <h6 class="mb-1">{{ achievement.name }}</h6>
                                    <small class="text-muted">{{ achievement.description }}</small>
                                    <div class="mt-2">
                                        <span class="badge bg-warning">+{{ achievement.xp }} XP</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- No Data State -->
    <div class="row">
        <div class="col text-center py-5">
            <i data-feather="map" class="text-muted mb-3" style="width: 4rem; height: 4rem;"></i>
            <h4 class="text-muted">Start Your Learning Journey</h4>
            <p class="text-muted">Read articles and use AI summaries to gain XP and unlock achievements</p>
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                <i data-feather="arrow-right" class="me-1"></i>
                Start Reading
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Recent Articles with Gamification -->
    {% if articles %}
    <div class="row">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i data-feather="book-open" class="me-2"></i>
                        Latest Articles - Earn XP by Reading!
                    </h5>
                    <div class="row">
                        {% for article in articles[:6] %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card border-0 shadow-sm h-100 gamified-article" data-article-index="{{ loop.index0 }}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="badge bg-secondary">{{ article.source.name if article.source else 'Unknown' }}</span>
                                        <small class="text-success fw-bold">+5 XP</small>
                                    </div>
                                    <h6 class="mb-2">{{ article.title[:80] }}{% if article.title|length > 80 %}...{% endif %}</h6>
                                    {% if article.description %}
                                    <p class="card-text text-muted small">{{ article.description[:100] }}{% if article.description|length > 100 %}...{% endif %}</p>
                                    {% endif %}
                                    <div class="d-flex gap-2 mt-auto">
                                        <a href="{{ article.url }}" target="_blank" class="btn btn-outline-primary btn-sm" onclick="trackArticleRead({{ loop.index0 }})">
                                            <i data-feather="external-link" class="me-1"></i>
                                            Read (+5 XP)
                                        </a>
                                        <button class="btn btn-outline-info btn-sm" onclick="generateSummaryWithXP({{ loop.index0 }}, this)">
                                            <i data-feather="cpu" class="me-1"></i>
                                            Summary (+3 XP)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% if articles|length > 6 %}
                    <div class="text-center mt-3">
                        <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                            <i data-feather="eye" class="me-1"></i>
                            View All {{ articles|length }} Articles
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Learning Resources Modal -->
<div class="modal fade" id="learningModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="learningModalTitle">Learning Resources</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="learningModalBody">
                <!-- Learning content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Learning Path Overview Modal -->
<div class="modal fade" id="pathModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pathModalTitle">Learning Path Overview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="pathModalBody">
                <!-- Path overview will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Achievement Notification Modal -->
<div class="modal fade" id="achievementModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body text-center">
                <i data-feather="award" class="text-warning mb-2" style="width: 3rem; height: 3rem;"></i>
                <h5 class="mb-2">Achievement Unlocked!</h5>
                <div id="achievementContent"></div>
                <button type="button" class="btn btn-primary btn-sm mt-2" data-bs-dismiss="modal">Awesome!</button>
            </div>
        </div>
    </div>
</div>

<script>
// Store articles data for tracking
const articlesData = {{ articles|tojson if articles else '[]' }};

// Learning paths data
const learningPathsData = {{ learning_data.learning_paths|tojson if learning_data else '{}' }};

// Learning resources database
const learningResources = {
    "ar_developer": {
        "name": "AR Developer",
        "levels": {
            1: {
                "title": "AR Basics",
                "topics": ["AR fundamentals", "ARCore", "ARKit"],
                "resources": [
                    {
                        "title": "Introduction to Augmented Reality",
                        "type": "tutorial",
                        "url": "https://developers.google.com/ar/discover",
                        "description": "Google's comprehensive guide to AR development fundamentals"
                    },
                    {
                        "title": "ARCore Developer Documentation",
                        "type": "documentation",
                        "url": "https://developers.google.com/ar/develop",
                        "description": "Official ARCore development guides and tutorials"
                    },
                    {
                        "title": "ARKit Developer Guide",
                        "type": "documentation", 
                        "url": "https://developer.apple.com/documentation/arkit/",
                        "description": "Apple's official ARKit documentation and samples"
                    },
                    {
                        "title": "AR/VR Development Course",
                        "type": "course",
                        "url": "https://www.coursera.org/learn/ar-technologies",
                        "description": "University course on AR technologies and development"
                    }
                ]
            },
            2: {
                "title": "AR Interactions",
                "topics": ["Hand tracking", "Gesture recognition", "Spatial mapping"],
                "resources": [
                    {
                        "title": "Hand Tracking in AR",
                        "type": "tutorial",
                        "url": "https://developers.meta.com/horizon/documentation/unity/unity-hand-tracking/",
                        "description": "Meta's guide to implementing hand tracking in AR applications"
                    },
                    {
                        "title": "Spatial Mapping with ARCore",
                        "type": "tutorial", 
                        "url": "https://developers.google.com/ar/develop/unity/occlusion",
                        "description": "Learn to implement spatial mapping and occlusion"
                    },
                    {
                        "title": "Gesture Recognition Tutorial",
                        "type": "course",
                        "url": "https://learn.unity.com/tutorial/gesture-recognition-in-ar",
                        "description": "Unity's official tutorial on implementing gesture recognition"
                    }
                ]
            },
            3: {
                "title": "AR Applications",
                "topics": ["AR games", "Industrial AR", "AR marketing"],
                "resources": [
                    {
                        "title": "Building AR Games",
                        "type": "course",
                        "url": "https://learn.unity.com/course/ar-game-development",
                        "description": "Complete course on creating engaging AR games"
                    },
                    {
                        "title": "Industrial AR Solutions",
                        "type": "guide",
                        "url": "https://www.ptc.com/en/technologies/augmented-reality",
                        "description": "Enterprise AR development patterns and case studies"
                    }
                ]
            },
            4: {
                "title": "Advanced AR",
                "topics": ["Computer vision", "SLAM", "AR cloud"],
                "resources": [
                    {
                        "title": "Computer Vision for AR",
                        "type": "course",
                        "url": "https://www.coursera.org/learn/computer-vision-opencv",
                        "description": "Advanced computer vision techniques for AR applications"
                    },
                    {
                        "title": "SLAM Algorithms",
                        "type": "documentation",
                        "url": "https://github.com/raulmur/ORB_SLAM2",
                        "description": "Real-time SLAM library for monocular, stereo and RGB-D cameras"
                    }
                ]
            },
            5: {
                "title": "AR Expert",
                "topics": ["AR research", "Custom AR engines", "AR leadership"],
                "resources": [
                    {
                        "title": "AR Research Papers",
                        "type": "resource",
                        "url": "https://arxiv.org/list/cs.CV/recent",
                        "description": "Latest computer vision and AR research publications"
                    },
                    {
                        "title": "Building AR Frameworks",
                        "type": "guide",
                        "url": "https://github.com/AR-js-org/AR.js",
                        "description": "Open source AR framework development"
                    }
                ]
            }
        }
    },
    "vr_developer": {
        "name": "VR Developer",
        "levels": {
            1: {
                "title": "VR Fundamentals", 
                "topics": ["VR basics", "Unity VR", "Unreal VR"],
                "resources": [
                    {
                        "title": "Unity VR Development",
                        "type": "documentation",
                        "url": "https://docs.unity3d.com/Manual/XR.html",
                        "description": "Unity's official XR and VR development documentation"
                    },
                    {
                        "title": "Unreal Engine VR Development",
                        "type": "documentation",
                        "url": "https://docs.unrealengine.com/5.0/en-US/vr-development-in-unreal-engine/",
                        "description": "Epic Games' VR development guide for Unreal Engine"
                    },
                    {
                        "title": "VR Best Practices",
                        "type": "guide",
                        "url": "https://developer.oculus.com/documentation/unity/unity-best-practices/",
                        "description": "Meta's VR development best practices and guidelines"
                    }
                ]
            },
            2: {
                "title": "VR Interactions",
                "topics": ["VR controllers", "Hand tracking", "Locomotion"],
                "resources": [
                    {
                        "title": "VR Controller Programming",
                        "type": "tutorial",
                        "url": "https://learn.unity.com/tutorial/vr-controller-input",
                        "description": "Unity tutorial on VR controller input and interactions"
                    },
                    {
                        "title": "VR Locomotion Systems",
                        "type": "course",
                        "url": "https://www.youtube.com/watch?v=p0YxzgQG2-E",
                        "description": "Comprehensive guide to VR movement and locomotion"
                    }
                ]
            },
            3: {
                "title": "VR Experiences",
                "topics": ["VR games", "VR training", "Social VR"],
                "resources": [
                    {
                        "title": "VR Game Design",
                        "type": "course",
                        "url": "https://www.udacity.com/course/vr-developer-nanodegree--nd017",
                        "description": "Complete VR game development nanodegree program"
                    },
                    {
                        "title": "VR Training Applications",
                        "type": "guide",
                        "url": "https://immersivelearning.institute/",
                        "description": "Best practices for educational and training VR experiences"
                    }
                ]
            },
            4: {
                "title": "Advanced VR",
                "topics": ["VR optimization", "Custom shaders", "VR physics"],
                "resources": [
                    {
                        "title": "VR Performance Optimization",
                        "type": "guide",
                        "url": "https://developer.oculus.com/documentation/unity/unity-perf/",
                        "description": "Meta's guide to optimizing VR applications for performance"
                    },
                    {
                        "title": "VR Shader Development",
                        "type": "tutorial",
                        "url": "https://learn.unity.com/tutorial/introduction-to-shader-graph",
                        "description": "Unity's Shader Graph for creating VR-optimized shaders"
                    }
                ]
            },
            5: {
                "title": "VR Master",
                "topics": ["VR research", "VR architecture", "VR innovation"],
                "resources": [
                    {
                        "title": "VR Research Conference",
                        "type": "resource",
                        "url": "https://ieeevr.org/",
                        "description": "IEEE Virtual Reality conference - latest VR research"
                    },
                    {
                        "title": "OpenXR Standards",
                        "type": "documentation",
                        "url": "https://www.khronos.org/openxr/",
                        "description": "Cross-platform VR/AR API standard development"
                    }
                ]
            }
        }
    },
    "unity_developer": {
        "name": "Unity Developer",
        "levels": {
            1: {
                "title": "Unity Basics",
                "topics": ["Unity interface", "GameObjects", "Components"],
                "resources": [
                    {
                        "title": "Unity Learn - Beginner Scripting",
                        "type": "course",
                        "url": "https://learn.unity.com/course/beginner-scripting",
                        "description": "Official Unity course for learning C# scripting basics"
                    },
                    {
                        "title": "Unity Manual",
                        "type": "documentation",
                        "url": "https://docs.unity3d.com/Manual/index.html",
                        "description": "Complete Unity engine documentation and user guide"
                    },
                    {
                        "title": "Unity Tutorials",
                        "type": "tutorial",
                        "url": "https://unity.com/learn/get-started",
                        "description": "Step-by-step tutorials to get started with Unity development"
                    }
                ]
            },
            2: {
                "title": "Unity Scripting",
                "topics": ["C# basics", "MonoBehaviour", "Unity API"],
                "resources": [
                    {
                        "title": "C# Programming for Unity",
                        "type": "course",
                        "url": "https://learn.unity.com/course/intermediate-scripting",
                        "description": "Intermediate Unity scripting and C# programming concepts"
                    },
                    {
                        "title": "Unity API Documentation",
                        "type": "documentation",
                        "url": "https://docs.unity3d.com/ScriptReference/",
                        "description": "Complete Unity scripting API reference"
                    }
                ]
            },
            3: {
                "title": "Game Development",
                "topics": ["Game mechanics", "UI systems", "Audio"],
                "resources": [
                    {
                        "title": "Unity Game Development",
                        "type": "course",
                        "url": "https://learn.unity.com/course/create-with-code",
                        "description": "Complete game development course with Unity"
                    },
                    {
                        "title": "Unity UI System",
                        "type": "tutorial",
                        "url": "https://learn.unity.com/tutorial/ui-canvas",
                        "description": "Building user interfaces in Unity"
                    }
                ]
            },
            4: {
                "title": "Advanced Unity",
                "topics": ["Optimization", "Custom tools", "Networking"],
                "resources": [
                    {
                        "title": "Unity Performance Optimization",
                        "type": "guide",
                        "url": "https://learn.unity.com/tutorial/fixing-performance-problems",
                        "description": "Professional optimization techniques for Unity games"
                    },
                    {
                        "title": "Unity Netcode for GameObjects",
                        "type": "documentation",
                        "url": "https://docs-multiplayer.unity3d.com/",
                        "description": "Unity's official multiplayer networking solution"
                    }
                ]
            },
            5: {
                "title": "Unity Expert",
                "topics": ["Unity architecture", "Performance", "Team leadership"],
                "resources": [
                    {
                        "title": "Unity Enterprise Solutions",
                        "type": "resource",
                        "url": "https://unity.com/solutions/gaming",
                        "description": "Professional Unity development and team management"
                    },
                    {
                        "title": "Unity Certified Expert",
                        "type": "course",
                        "url": "https://unity.com/learn/certification",
                        "description": "Unity professional certification program"
                    }
                ]
            }
        }
    },
    "blender_artist": {
        "name": "3D Artist (Blender)",
        "levels": {
            1: {
                "title": "Blender Basics",
                "topics": ["Blender interface", "Basic modeling", "Materials"],
                "resources": [
                    {
                        "title": "Blender Fundamentals",
                        "type": "course",
                        "url": "https://www.youtube.com/playlist?list=PLjEaoINr3zgFX8ZsChQVQsuDSjEqdWMAD",
                        "description": "Official Blender Foundation tutorial series for beginners"
                    },
                    {
                        "title": "Blender Documentation",
                        "type": "documentation", 
                        "url": "https://docs.blender.org/manual/en/latest/",
                        "description": "Complete Blender user manual and reference guide"
                    },
                    {
                        "title": "Donut Tutorial by Blender Guru",
                        "type": "tutorial",
                        "url": "https://www.youtube.com/watch?v=nIoXOplUvAw",
                        "description": "Famous beginner-friendly Blender modeling and rendering tutorial"
                    }
                ]
            }
        }
    },
    "game_developer": {
        "name": "Game Developer",
        "levels": {
            1: {
                "title": "Game Design",
                "topics": ["Game mechanics", "Level design", "Player experience"],
                "resources": [
                    {
                        "title": "Game Design Fundamentals",
                        "type": "course",
                        "url": "https://www.coursera.org/learn/game-design",
                        "description": "University course covering game design principles and mechanics"
                    },
                    {
                        "title": "Level Design Patterns",
                        "type": "guide", 
                        "url": "https://www.gamedeveloper.com/design/level-design-patterns-and-techniques",
                        "description": "Professional guide to level design techniques and patterns"
                    },
                    {
                        "title": "Game Development Resources",
                        "type": "resource",
                        "url": "https://github.com/ellisonleao/magictools",
                        "description": "Comprehensive list of game development tools and resources"
                    }
                ]
            }
        }
    },
    "xr_developer": {
        "name": "XR Developer",
        "levels": {
            1: {
                "title": "XR Fundamentals",
                "topics": ["Mixed reality basics", "OpenXR", "WebXR"],
                "resources": [
                    {
                        "title": "OpenXR Specification",
                        "type": "documentation",
                        "url": "https://www.khronos.org/openxr/",
                        "description": "The industry standard for XR applications and devices"
                    },
                    {
                        "title": "WebXR Device API",
                        "type": "documentation",
                        "url": "https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API",
                        "description": "Mozilla's WebXR development guide for web-based XR experiences"
                    },
                    {
                        "title": "Mixed Reality Development",
                        "type": "course",
                        "url": "https://docs.microsoft.com/en-us/learn/paths/beginner-mixed-reality/",
                        "description": "Microsoft's comprehensive mixed reality development course"
                    },
                    {
                        "title": "XR Development Fundamentals",
                        "type": "tutorial",
                        "url": "https://unity.com/solutions/xr",
                        "description": "Unity's XR development platform and tutorials"
                    }
                ]
            },
            2: {
                "title": "Cross-Platform XR",
                "topics": ["Multi-device XR", "Shared experiences", "XR frameworks"],
                "resources": [
                    {
                        "title": "Unity XR Toolkit",
                        "type": "documentation",
                        "url": "https://docs.unity3d.com/Packages/com.unity.xr.interaction.toolkit@latest/",
                        "description": "Unity's cross-platform XR interaction system"
                    },
                    {
                        "title": "A-Frame WebXR Framework",
                        "type": "tutorial",
                        "url": "https://aframe.io/docs/1.3.0/introduction/",
                        "description": "Web framework for building virtual reality experiences"
                    },
                    {
                        "title": "8th Wall WebAR",
                        "type": "guide",
                        "url": "https://www.8thwall.com/docs/",
                        "description": "Cross-platform WebAR development platform"
                    }
                ]
            },
            3: {
                "title": "XR Applications",
                "topics": ["Enterprise XR", "Social XR", "XR for education"],
                "resources": [
                    {
                        "title": "Enterprise XR Solutions",
                        "type": "guide",
                        "url": "https://www.microsoft.com/en-us/hololens/industry",
                        "description": "Microsoft HoloLens enterprise application development"
                    },
                    {
                        "title": "Social VR Development",
                        "type": "course",
                        "url": "https://developer.oculus.com/documentation/unity/unity-multiplayer-overview/",
                        "description": "Building multiplayer and social VR experiences"
                    },
                    {
                        "title": "Educational XR Applications",
                        "type": "resource",
                        "url": "https://immersivelearning.institute/",
                        "description": "Best practices for educational XR development"
                    }
                ]
            },
            4: {
                "title": "Advanced XR",
                "topics": ["XR optimization", "Custom XR tools", "XR analytics"],
                "resources": [
                    {
                        "title": "XR Performance Optimization",
                        "type": "guide",
                        "url": "https://docs.unity3d.com/Manual/XROptimization.html",
                        "description": "Unity's guide to optimizing XR applications for performance"
                    },
                    {
                        "title": "Custom XR Tools Development",
                        "type": "tutorial",
                        "url": "https://github.com/MixedRealityToolkit/MixedRealityToolkit-Unity",
                        "description": "Microsoft Mixed Reality Toolkit for custom XR development"
                    },
                    {
                        "title": "XR Analytics and Telemetry",
                        "type": "documentation",
                        "url": "https://developers.google.com/ar/develop/unity/analytics",
                        "description": "Implementing analytics in XR applications"
                    }
                ]
            },
            5: {
                "title": "XR Expert",
                "topics": ["XR research", "XR platform development", "XR innovation"],
                "resources": [
                    {
                        "title": "IEEE VR Conference",
                        "type": "resource",
                        "url": "https://ieeevr.org/",
                        "description": "Latest XR research and academic publications"
                    },
                    {
                        "title": "XR Platform Architecture",
                        "type": "guide",
                        "url": "https://github.com/immersive-web/webxr",
                        "description": "WebXR platform development and standards"
                    },
                    {
                        "title": "Future of XR Technology",
                        "type": "resource",
                        "url": "https://www.roadtovr.com/",
                        "description": "Industry insights and XR technology trends"
                    }
                ]
            }
        }
    }
};

function showLearningResources(pathId, level) {
    const pathData = learningResources[pathId];
    if (!pathData || !pathData.levels[level]) {
        alert('Learning resources not available for this level yet. Check back soon!');
        return;
    }
    
    const levelData = pathData.levels[level];
    const modal = new bootstrap.Modal(document.getElementById('learningModal'));
    
    document.getElementById('learningModalTitle').textContent = `${pathData.name} - ${levelData.title}`;
    
    let resourcesHtml = `
        <div class="mb-3">
            <h6 class="text-primary">Topics for this level:</h6>
            <div class="mb-3">
                ${levelData.topics.map(topic => `<span class="badge bg-light text-dark me-1 mb-1">${topic}</span>`).join('')}
            </div>
        </div>
        
        <h6 class="text-success mb-3">Learning Resources:</h6>
        <div class="row">
    `;
    
    levelData.resources.forEach(resource => {
        const typeColor = {
            'tutorial': 'primary',
            'documentation': 'info', 
            'course': 'success',
            'guide': 'warning',
            'resource': 'secondary'
        };
        
        resourcesHtml += `
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-${typeColor[resource.type] || 'secondary'}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title mb-0">${resource.title}</h6>
                            <span class="badge bg-${typeColor[resource.type] || 'secondary'}">${resource.type}</span>
                        </div>
                        <p class="card-text text-muted small">${resource.description}</p>
                        <a href="${resource.url}" target="_blank" class="btn btn-outline-${typeColor[resource.type] || 'secondary'} btn-sm">
                            <i data-feather="external-link" class="me-1"></i>
                            Start Learning
                        </a>
                    </div>
                </div>
            </div>
        `;
    });
    
    resourcesHtml += `
        </div>
        <div class="mt-4 p-3 bg-light rounded">
            <h6 class="text-dark mb-2">💡 Learning Tips:</h6>
            <ul class="text-dark mb-0">
                <li>Start with official documentation to understand fundamentals</li>
                <li>Follow tutorials step-by-step and practice with your own projects</li>
                <li>Join community forums and Discord servers for help</li>
                <li>Build small projects to apply what you learn</li>
                <li>Keep reading XR news to stay updated on industry trends</li>
            </ul>
        </div>
    `;
    
    document.getElementById('learningModalBody').innerHTML = resourcesHtml;
    feather.replace();
    modal.show();
}

function showLearningPath(pathId) {
    const pathData = learningResources[pathId];
    if (!pathData) {
        alert('Learning path details not available yet.');
        return;
    }
    
    const userPath = learningPathsData[pathId];
    const currentLevel = userPath ? userPath.current_level : 1;
    
    const modal = new bootstrap.Modal(document.getElementById('pathModal'));
    document.getElementById('pathModalTitle').textContent = `${pathData.name} - Complete Learning Path`;
    
    let pathHtml = `
        <div class="mb-4">
            <h6 class="text-primary">Your Progress</h6>
            <div class="d-flex align-items-center mb-2">
                <span class="badge bg-primary me-2">Level ${currentLevel}</span>
                <span class="text-muted">${userPath ? userPath.xp : 0} XP earned</span>
            </div>
        </div>
        
        <h6 class="text-success mb-3">Learning Path Overview:</h6>
    `;
    
    // Show all levels
    for (let level = 1; level <= 5; level++) {
        const levelData = pathData.levels[level];
        const isCurrentLevel = level === currentLevel;
        const isCompleted = level < currentLevel;
        const isLocked = level > currentLevel;
        
        let statusClass = 'secondary';
        let statusIcon = 'lock';
        let statusText = 'Locked';
        
        if (isCompleted) {
            statusClass = 'success';
            statusIcon = 'check-circle';
            statusText = 'Completed';
        } else if (isCurrentLevel) {
            statusClass = 'primary';
            statusIcon = 'play-circle';
            statusText = 'Current Level';
        }
        
        pathHtml += `
            <div class="card mb-3 ${isCurrentLevel ? 'border-primary' : ''}">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <div class="d-flex align-items-center mb-2">
                                <i data-feather="${statusIcon}" class="text-${statusClass} me-2"></i>
                                <h6 class="mb-0">Level ${level}: ${levelData ? levelData.title : `Level ${level}`}</h6>
                                <span class="badge bg-${statusClass} ms-2">${statusText}</span>
                            </div>
                            ${levelData ? `
                                <div class="mb-2">
                                    <small class="text-muted">Topics:</small><br>
                                    ${levelData.topics.map(topic => `<span class="badge bg-light text-dark me-1 mb-1">${topic}</span>`).join('')}
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">${levelData.resources ? levelData.resources.length : 0} learning resources available</small>
                                </div>
                            ` : '<p class="text-muted">Coming soon...</p>'}
                        </div>
                        <div class="text-end">
                            ${levelData && (isCurrentLevel || isCompleted) ? `
                                <button class="btn btn-outline-${statusClass} btn-sm" onclick="showLearningResources('${pathId}', ${level})">
                                    <i data-feather="book-open" class="me-1"></i>
                                    Learn
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    pathHtml += `
        <div class="mt-4 p-3 bg-info bg-opacity-10 rounded border-info">
            <h6 class="text-info mb-2">🚀 How to Progress:</h6>
            <ul class="text-muted mb-0">
                <li><strong>Read articles</strong> related to ${pathData.name} topics (+5 XP each)</li>
                <li><strong>Generate AI summaries</strong> to better understand content (+3 XP each)</li>
                <li><strong>Complete learning resources</strong> from each level</li>
                <li><strong>Build projects</strong> using what you learn</li>
                <li><strong>Stay consistent</strong> - daily reading builds your streak!</li>
            </ul>
        </div>
    `;
    
    document.getElementById('pathModalBody').innerHTML = pathHtml;
    feather.replace();
    modal.show();
}

function trackArticleRead(articleIndex) {
    const article = articlesData[articleIndex];
    if (!article) return;
    
    // Determine topic category from matched keyword or title
    let topicCategory = 'general';
    const title = article.title.toLowerCase();
    
    if (title.includes('unity') || title.includes('game development')) {
        topicCategory = 'unity_developer';
    } else if (title.includes('blender') || title.includes('3d modeling')) {
        topicCategory = 'blender_artist';
    } else if (title.includes('ar') || title.includes('augmented reality')) {
        topicCategory = 'ar_developer';
    } else if (title.includes('vr') || title.includes('virtual reality')) {
        topicCategory = 'vr_developer';
    }
    
    fetch('/api/track_article_read', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            article: article,
            topic_category: topicCategory
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.result) {
            showXPGain(data.result.xp_awarded);
            
            if (data.result.new_achievements && data.result.new_achievements.length > 0) {
                showAchievementUnlocked(data.result.new_achievements[0]);
            }
            
            if (data.result.level_ups && data.result.level_ups.length > 0) {
                showLevelUp(data.result.level_ups[0]);
            }
        }
    })
    .catch(error => console.log('Tracking error:', error));
}

function generateSummaryWithXP(articleIndex, button) {
    // First track the summary generation
    fetch('/api/track_summary', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.result) {
            showXPGain(data.result.xp_awarded);
            
            if (data.result.new_achievements && data.result.new_achievements.length > 0) {
                showAchievementUnlocked(data.result.new_achievements[0]);
            }
        }
    })
    .catch(error => console.log('Tracking error:', error));
    
    // Then generate the actual summary (reuse existing function)
    generateSummary(articleIndex, button);
}

function showXPGain(xp) {
    // Create floating XP notification
    const notification = document.createElement('div');
    notification.className = 'alert alert-success position-fixed';
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; animation: slideIn 0.3s ease-out;';
    notification.innerHTML = `
        <div class="d-flex align-items-center">
            <i data-feather="plus-circle" class="me-2"></i>
            <span>+${xp} XP earned!</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    feather.replace();
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => notification.remove(), 300);
    }, 2000);
}

function showAchievementUnlocked(achievement) {
    const modal = new bootstrap.Modal(document.getElementById('achievementModal'));
    document.getElementById('achievementContent').innerHTML = `
        <h6 class="text-warning">${achievement.name}</h6>
        <p class="text-muted small">${achievement.description}</p>
        <span class="badge bg-warning">+${achievement.xp} XP</span>
    `;
    modal.show();
}

function showLevelUp(levelData) {
    // Show level up notification
    const notification = document.createElement('div');
    notification.className = 'alert alert-primary position-fixed';
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; animation: slideIn 0.3s ease-out;';
    notification.innerHTML = `
        <div class="d-flex align-items-center">
            <i data-feather="arrow-up" class="me-2"></i>
            <span>Level Up! ${levelData.path} - ${levelData.level_title}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    feather.replace();
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => notification.remove(), 3000);
    }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
    
    .gamified-article {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .gamified-article:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
